<!-- 66216504-5c79-4776-af71-a9805bf71997 650dbe08-b15a-42ae-8bd1-1c6224a7726e -->
# Trash for Passwords — UI/UX and Behavior

## Scope and Policy

- Keep only the last 5 deleted passwords per user
- On each soft delete: mark `isDeleted=true`, set `deletedAt=serverTimestamp()`
- If trashed count > 5, permanently delete oldest extras immediately (client transaction or Cloud Function)
- Rate limits (already present): daily caps for delete/restore to avoid abuse
- No time‑based retention for now (capacity wins); optional 7‑day retention can be layered later

## Data/Rules

- Firestore: reuse `users/{uid}/passwords/{id}`
- Fields: `isDeleted: boolean`, `deletedAt: Timestamp|null`
- Reading lists:
- Vault views exclude `isDeleted==true`
- Trash view shows only `isDeleted==true`, sorted by `deletedAt desc`
- Rules: existing `users/{uid}/passwords` read/write suffice (no new rule needed)

## UX

- Entry points
- “Delete” in row/card → soft delete → success toast with Undo (restores)
- Sidebar badge: “Trash (N/5)” showing current trash count
- Trash page (`/pw/trash`)
- Header: "Trash" + subtext: "Last 5 deleted passwords are kept here"
- List: cards/rows with name, username, url, deleted time
- Actions per item: Restore, Delete Forever
- Bulk actions (when selected): Restore selected, Delete forever selected
- Empty state: helpful copy + link back to Vault
- Safety UX: confirmation modal for permanent delete (single and bulk)
- Undo flow
- After delete from Vault: toast "Moved to Trash" with Undo for 5s
- If Undo pressed and still present: restore and toast "Restored"
- Limits surfaced
- When trying to delete with 5 already present: we still accept delete, then immediately purge the oldest trashed item(s) and show toast "Older items permanently deleted"
- Daily limit reached (store already enforces): show error toast

## Keyboard/Shortcuts

- On Trash page: `Del` triggers "Delete Forever" confirm for selection
- `Enter` restores when a single item is focused/selected

## Implementation Touchpoints

- Store (`src/stores/passwordStore.ts`)
- add: `fetchTrashed()`, `getTrashCount()`, `hardDelete(id)`, `restorePassword(id)` (exists), `purgeOldestIfOverLimit()` called after soft delete
- modify `softDeletePassword` to run a transaction:
  - set `isDeleted=true`, `deletedAt=serverTimestamp()`
  - query trashed > 5 (ordered by `deletedAt asc`) and hard delete oldest extras
- expose a selector to get `trashCount`
- UI
- `src/components/pw/PasswordList.tsx` and Row/Card: wire Undo toast
- `src/components/pw/PwConfirmDialog.tsx`: reuse for permanent deletion
- `src/pages/TrashPage.tsx` (existing route): implement list with restore/hard delete + bulk
- `src/components/pw/SidebarNav.tsx`: add Trash badge `N/5`
- Cloud Function (optional alt)
- If we prefer server enforcement: add `onWrite(users/{uid}/passwords/{id})` to hard‑delete overflow trashed docs; otherwise keep client transaction (simpler)

## Abuse Resistance

- Keep capacity to 5 using transactional enforcement
- Maintain existing daily rate limits for soft delete and restore
- Permanent delete always requires explicit confirmation

## Nice‑to‑Haves (later)

- Time‑based retention (e.g., 7 days) with scheduled purge
- Export before purge prompt for users with frequent deletions

### To-dos

- [ ] Add fetchTrashed, hardDelete, purge overflow, and trashCount to passwordStore
- [ ] Show toast with Undo on delete; restore if clicked
- [ ] Implement Trash list with restore, delete forever, and bulk actions
- [ ] Show Trash badge with N/5 in Sidebar
- [ ] Add Delete/Enter keyboard shortcuts on Trash page